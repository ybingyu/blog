(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{378:function(e,t,a){"use strict";a.r(t);var n=a(44),r=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"项目背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目背景"}},[e._v("#")]),e._v(" 项目背景")]),e._v(" "),a("ul",[a("li",[e._v("活动前面为视频背景")]),e._v(" "),a("li",[e._v("活动游戏内容为摇一摇助力")]),e._v(" "),a("li",[e._v("兼容平台为：微信小程序与QQ内，其他平台为二维码引流页面。")])]),e._v(" "),a("p",[e._v("无接口版体验地址，请手机访问\nhttps://zydown.99.com/gw/other/package/yby/2021/06/hy/")]),e._v(" "),a("h1",{attrs:{id:"项目总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目总结"}},[e._v("#")]),e._v(" 项目总结")]),e._v(" "),a("h2",{attrs:{id:"视频兼容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视频兼容"}},[e._v("#")]),e._v(" 视频兼容")]),e._v(" "),a("h3",{attrs:{id:"行内视频"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#行内视频"}},[e._v("#")]),e._v(" 行内视频")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(' <video src="https://" loop="true" id="index1Video" poster="https://" preload="auto" autoplay \n                        x5-video-player-type="h5"\n                        x5-video-player-fullscreen="true" webkit-playsinline="" x-webkit-airplay="true" airplay="allow"\n                        playsinline="" class="video video-1" \n                        muted=\'true\'></video>\n')])])]),a("h3",{attrs:{id:"自动播放"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动播放"}},[e._v("#")]),e._v(" 自动播放")]),e._v(" "),a("p",[e._v("视频不允许自动播放，需要用户交互（点击）。所以在每个视频前，注意要设置点击的环节。"),a("br"),e._v("\nIOS12+，点击一个video标签，其余的video也都被允许播放。而安卓与ios12，每个视频video标签都需要用户交互（点击），才可播放。因此，视频自动切换时用同一个video标签，换src。有前置交互的可以设置不同的video标签")]),e._v(" "),a("h3",{attrs:{id:"跳过视频"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跳过视频"}},[e._v("#")]),e._v(" 跳过视频")]),e._v(" "),a("p",[e._v("需要直接跳过视频，到视频结尾。")]),e._v(" "),a("p",[e._v("安卓"),a("code",[e._v("v.currentTime= v.duration")]),e._v("跳过视频无效 。最后采用隐藏视频直接显示结尾的静态图的方案。")]),e._v(" "),a("p",[a("a",{attrs:{href:"http://w.bindyy.cn/tools/video.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("视频截图工具"),a("OutboundLink")],1)]),e._v(" "),a("h3",{attrs:{id:"onend"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onend"}},[e._v("#")]),e._v(" onend")]),e._v(" "),a("p",[e._v("部分安卓机（某个型号的小米）不执行video.onend，与监听ontimeupdate(e.currentTarget.currentTime )一起使用")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("document.getElementById('cutVideo').ontimeupdate = function (e) {\n    if (e.currentTarget.currentTime > 14) {// 时间为已知14s\n        console.log('ppp')\n    }\n}\n")])])]),a("h2",{attrs:{id:"音频"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#音频"}},[e._v("#")]),e._v(" 音频")]),e._v(" "),a("p",[e._v("安卓系统用web audio api的原因：")]),e._v(" "),a("ol",[a("li",[e._v("安卓播放视频（即使是静音的），背景音乐的audio会变小声。")]),e._v(" "),a("li",[e._v("安卓audio不允许多音轨"),a("br"),e._v("\nIOS不用web audio api，是因为要自动播放背景音乐，用web auido api就无法自动播放，安卓会自动播放")])]),e._v(" "),a("h2",{attrs:{id:"震动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#震动"}},[e._v("#")]),e._v(" 震动")]),e._v(" "),a("p",[e._v("安卓支持震动、IOS不支持")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("if (navigator.vibrate) {\n    navigator.vibrate(1000);//震动秒数\n} else if (navigator.webkitVibrate) {\n    navigator.webkitVibrate(1000);\n} else {\n    console.log('不支持震动')\n}\n            \n")])])]),a("h2",{attrs:{id:"摇一摇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#摇一摇"}},[e._v("#")]),e._v(" 摇一摇")]),e._v(" "),a("p",[e._v("IOS权限获取需要HTTPS环境，必须要用户同意。点击时调用"),a("code",[e._v("iosGrantedTips")]),e._v("。如果用户拒绝了，关闭APP，会再次发请求。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("        // 摇一摇权限\n        iosGrantedTips() {\n            var ua = navigator.userAgent.toLowerCase();\n            if (ua.indexOf(\"like mac os x\") > 0) {\n                var verinfo = ua.match(/cpu iphone os (.*?) like mac os/);\n                var version = verinfo[1].replace(/_/g, \".\");\n                console.log('version', version)\n                var arr = version.split(\".\");\n                if ((arr[0] > 12 && arr[0] <= 13 && arr[1] > 2) || arr[0] >= 14) {  //对13.3以后的版本处理,包括13.3,\n\n                    this.ios13granted()\n\n                    return;\n                }\n            }\n\n            //13.3以前的版本或者安卓\n            this.iosDeviceGranted()\n        },\n        ios13granted() {\n            var self = this\n            if (typeof DeviceMotionEvent.requestPermission === 'function') {\n                DeviceMotionEvent.requestPermission().then((permissionState) => {\n                    /* granted（被授予），denied（被拒绝） 或者default（默认） */\n                    // console.log('p', permissionState)\n                    if (permissionState === 'granted') {\n                        self.iosDeviceGranted()\n                    } else {\n                        // alert(1)\n                        self.iosDeviceDenied()\n                    }\n                }).catch((err) => {\n                    self.iosDeviceDenied()\n                    // alert(JSON.stringify(err))\n                })\n            } else {\n                // 处理常规的非iOS 13+设备\n                self.iosDeviceGranted()\n            }\n        },\n        // 授权完可以开始游戏\n        iosDeviceGranted() {\n            this.togglePage('game')\n\n            this.closePop('toolSure', true)\n        },\n        // 如果ios被拒绝\n        iosDeviceDenied() {\n            alert(\"您未允许权限，请将App关闭或者清除缓存后重新访问授权\");\n        },\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);